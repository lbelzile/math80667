<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Experimental design and statistical methods - 6&nbsp; Designs to reduce the error</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./07-power_effect.html" rel="next">
<link href="./05-interactions_multiway.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="style.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./06-blocking.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Designs to reduce the error</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Experimental design and statistical methods</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/lbelzile/math80667a/" rel="" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <a href="./MATH80667A-EDSM.pdf" rel="" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-hypothesis_testing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Hypothesis testing</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-completely_randomized_trials.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Completely randomized designs</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-contrasts_multipletesting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Contrasts and multiple testing</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-interactions_multiway.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Complete factorial designs</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-blocking.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Designs to reduce the error</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-power_effect.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Effect sizes and power</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-reproducibility_crisis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Replication crisis</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-repeated.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Repeated measures and multivariate models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-mixed.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Introduction to mixed models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-causal-inference.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Causal inference</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-nonparametric.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Nonparametric tests</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">References</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#ancova" id="toc-ancova" class="nav-link active" data-scroll-target="#ancova"><span class="header-section-number">6.1</span> Analysis of covariance</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/lbelzile/math80667a/edit/main/06-blocking.qmd" class="toc-action">Edit this page</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header">
<h1 class="title display-7"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Designs to reduce the error</span></h1>

</header>

<p>The previous chapter dealt with factorial experiments in which all experimental factors are of interest. In many instances, some of the characteristics of observational units are not of interest: for example, EEG measurements of participants in a lab may differ due to time of the day, to the lab technician, etc. These are instances of <strong>blocking factors</strong>: variables that impact the measurements’s variability, but that are not of direct interest. By filtering their effect out and looking at the residual variability that is unexplained by the blocking factors. Block designs reduce the error term, at the cost of including and estimating additional parameters (group average or slope).</p>
<p>We will analyse block designs in the same as we did for multi-way analysis of variance model, with one notable exception. Typically, we will assume that there is <strong>no interaction</strong> between experimental factor and blocking factors.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> Thus, we will be interested mostly in marginal effects.</p>
<p>A related design includes a continuous covariate to the analysis of variance, whose slope governs the relationship with the response. The strict inclusion isn’t necessary to draw valid causal conclusion, but adding the term helps again reduce the residual variability. Such a design was historically called <strong>analysis of covariance</strong>, an instance of a linear model.</p>
<p>Including blocking factor or covariates should in principle increase power and our ability to detect real differences due to experimental manipulations, provided the variables used as control are correlated with the response. Generally, they are not needed for valid inference, which is guaranteed by randomization, and shouldn’t be used to assign treatment.</p>
<section id="ancova" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="ancova"><span class="header-section-number">6.1</span> Analysis of covariance</h2>
<p>In an analysis of covariance, we include a linear component for a (continuous) covariate, with the purpose again to reduce residual error. A prime example is prior/post experiment measurements, whereby we monitor the change in outcome due to the manipulation.</p>
<p>In such setting, it may seem logical to take the difference in post and prior score as response: this is showcased in <a href="#exm-vanStek">Example&nbsp;<span>6.1</span></a> and <span class="citation" data-cites="Baumann:1992">Baumann, Seifert-Kessell, and Jones (<a href="references.html#ref-Baumann:1992" role="doc-biblioref">1992</a>)</span>, an analysis of which is presented on <a href="https://edsm.rbind.io/example/06-ancova/">the course website</a>.</p>
<p>When we add a covariate, we need the latter to have a strong linear correlation for the inclusion to make sense. We can assess graphically whether the relationship is linear, and whether the slopes for each experimental condition are the same.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
<div class="cell" data-layout-align="center" data-hash="06-blocking_cache/html/fig-ancovadifftrend_6819c5448069f061f3c1104a7f0848cd">
<div class="cell-output-display">
<div id="fig-ancovadifftrend" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="06-blocking_files/figure-html/fig-ancovadifftrend-1.png" class="img-fluid figure-img" style="width:85.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;6.1: Simulated data from two groups with an analysis of covariance model.</figcaption>
</figure>
</div>
</div>
</div>
<p>The left panel of <a href="#fig-ancovadifftrend">Figure&nbsp;<span>6.1</span></a> shows the ideal situation for an analysis of covariate: the relationship between response and covariate is linear with strong correlation, with the same slope and overlapping support. Since the slopes are the same, we can compare the difference in average (the vertical difference between slopes at any level of the covariate) because the latter is constant, so this depiction is useful. By contrast, the right-hand panel of <a href="#fig-ancovadifftrend">Figure&nbsp;<span>6.1</span></a> shows an interaction between the covariate and the experimental groups, different slopes: there, the effect of the experimental condition increases with the level of the covariate. One may also note that the lack of overlap in the support, the set of values taken by the covariate, for the two experimental conditions, makes comparison hazardous at best in the right-hand panel.</p>
<p><a href="#fig-ancovaresid">Figure&nbsp;<span>6.2</span></a> shows that, due to the strong correlation, the variability of the measurements is smaller on the right-hand panel (corresponding to the analysis of covariance model) than for the centred response on the left-hand panel; note that the <span class="math inline">\(y\)</span>-axes have different scales.</p>
<div class="cell" data-layout-align="center" data-hash="06-blocking_cache/html/fig-ancovaresid_e17aff14f964d934aa90ade53080f36a">
<div class="cell-output-display">
<div id="fig-ancovaresid" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="06-blocking_files/figure-html/fig-ancovaresid-1.png" class="img-fluid figure-img" style="width:85.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;6.2: Response after subtracting mean (left) and after detrending (right).</figcaption>
</figure>
</div>
</div>
</div>
<p>We present two examples of analysis of covariance, showing how the inclusion of covariates helps disentangle differences between experimental conditions.</p>
<div id="leechoi" class="example" name="Inconsistency of product description and image in online retailing">
<p><span class="citation" data-cites="Lee.Choi:2019">Lee and Choi (<a href="references.html#ref-Lee.Choi:2019" role="doc-biblioref">2019</a>)</span> measured the impact of discrepancies between descriptions and visual depiction of items in online retail. They performed an experiment in which participants were presented with descriptions of a product (a set of six toothbrushes) that was either consistent or inconsistent with the description. The authors postulated that a discrepancy could lead to lower appreciation score, measured using three Likert scales. They also suspected that the familiarity with the product brand should impact ratings, and controlled for the latter using another question.</p>
<p>One way to account for familiarity when comparing the mean is to use a linear regression with familiarity as another explanatory variable. The expected value of the product evaluation is <span id="eq-vS"><span class="math display">\[
\mathsf{E}(\texttt{prodeval}) = \beta_0 + \beta_1 \texttt{familiarity} + \beta_2 \texttt{consistency},
\tag{6.1}\]</span></span> where <span class="math inline">\(\texttt{familiarity}\)</span> is the score from 1 to 7 and <span class="math inline">\(\texttt{consistency}\)</span> is a binary indicator equal to one if the output is inconsistent and zero otherwise. The coefficient <span class="math inline">\(\beta_2\)</span> thus measures the difference between product evaluation rating for consistent vs inconsistent displays, for the same familiarity score.</p>
<p>We can look at coefficient (standard error) estimates <span class="math inline">\(\widehat{\beta}_2 = -0.64 (0.302)\)</span>. No difference between groups would mean <span class="math inline">\(\beta_2=0\)</span> and we can build a test statistic by looking at the standardized regression coefficient <span class="math inline">\(t = \widehat{\beta}_2/\mathsf{se}(\widehat{\beta}_2)\)</span>. The result output is <span class="math inline">\(b = -0.64\)</span>, 95% CI <span class="math inline">\([-1.24, -0.04]\)</span>, <span class="math inline">\(t(93) = -2.12\)</span>, <span class="math inline">\(p = .037\)</span>. We reject the null hypothesis of equal product evaluation for both display at level 5%: there is evidence that there is a small difference, with people giving on average a score that is 0.64 points smaller (on a scale of 1 to 9) when presented with conflicting descriptions and images.</p>
<p>We can compare the analysis of variance table obtained by fitting the model with and without <span class="math inline">\(\texttt{familiarity}\)</span>. <a href="#tbl-anovatabLC19S1">Table&nbsp;<span>6.1</span></a> shows that the effect of consistency is small and not significant and a two-sample <em>t</em>-test shows no evidence of difference between the average familiarity score in both experimental conditions (<span class="math inline">\(p\)</span>-value of <span class="math inline">\(.532\)</span>). However, we can explain roughly one fifth of the residual variability by the familiarity with the brand (see the sum of squares in <a href="#tbl-anovatabLC19S1">Table&nbsp;<span>6.1</span></a>): removing the latter leads to a higher signal-to-noise ratio for the impact of consistency, at the expense of a loss of one degree of freedom. Thus, it appears that the manipulation was successful.</p>
<div id="tbl-anovatabLC19S1" class="cell tbl-parent quarto-layout-panel anchored" data-hash="06-blocking_cache/html/tbl-anovatabLC19S1_638b2f48a077b466f057407d3357ed06">
<div class="panel-caption table-caption">
<p>Table&nbsp;6.1: Analysis of variance tables</p>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div id="tbl-anovatabLC19S1-1" class="quarto-layout-cell quarto-layout-cell-subref anchored" data-ref-parent="tbl-anovatabLC19S1" style="flex-basis: 100.0%;justify-content: center;">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<caption>(a) model without familiarity</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">term</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">sum. sq.</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">df</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">stat</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">p-value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">consistency</td>
<td style="text-align: right;">7.04</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.55</td>
<td style="text-align: left;">.113</td>
</tr>
<tr class="even">
<td style="text-align: left;">Residuals</td>
<td style="text-align: right;">259.18</td>
<td style="text-align: right;">94</td>
<td style="text-align: right;"></td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: center;">


</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div id="tbl-anovatabLC19S1-2" class="quarto-layout-cell quarto-layout-cell-subref anchored" data-ref-parent="tbl-anovatabLC19S1" style="flex-basis: 100.0%;justify-content: center;">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<caption>(b) model with familiarity</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">term</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">sum. sq.</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">df</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">stat</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">p-value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">familiarity</td>
<td style="text-align: right;">55.9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">25.60</td>
<td style="text-align: left;">&lt; .001</td>
</tr>
<tr class="even">
<td style="text-align: left;">consistency</td>
<td style="text-align: right;">9.8</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4.49</td>
<td style="text-align: left;">.037</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Residuals</td>
<td style="text-align: right;">203.2</td>
<td style="text-align: right;">93</td>
<td style="text-align: right;"></td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: center;">


</div>
</div>
</div>
<div class="cell" data-layout-align="center" data-hash="06-blocking_cache/html/fig-ANCOVA-demo_293bdcb2a7c1f8e542eca13ab53499e3">
<div class="cell-output-display">
<div id="fig-ANCOVA-demo" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="06-blocking_files/figure-html/fig-ANCOVA-demo-1.png" class="img-fluid figure-img" style="width:85.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;6.3: Scatterplot of product evaluation as a function of the familiarity score, split by experimental manipulation.</figcaption>
</figure>
</div>
</div>
</div>
<p><a href="#fig-ANCOVA-demo">Figure&nbsp;<span>6.3</span></a> shows that people more familiar with the product or brand tend to have a more positive product evaluation, as postulated by the authors. The graph also shows two straight lines corresponding to the fit of a linear model with different intercept and slope for each display group: there is little material difference, one needs to assess formally whether a single linear relationship as the one postulated in <a href="#eq-vS">Equation&nbsp;<span>6.1</span></a> can adequately characterize the relation in both groups.</p>
<p>To this effect, we fit a linear model with different slopes in each group, and compare the fit of the latter with the analysis of covariance model that includes a single slope for both groups: we can then test if the slopes are the same, or alternatively if the difference between the slopes is zero. The <em>t</em>-statistic indicates no difference in slope (<span class="math inline">\(p\)</span>-value of <span class="math inline">\(.379\)</span>), thus the assumption is reasonable. Levene’s test for homogeneity of variance indicates no discernible difference between groups. Thus, it appears there is a difference in perception of product quality due to the manipulation.</p>
</div>
<div id="exm-vanStek" class="theorem example">
<p><span class="theorem-title"><strong>Example 6.1 (Effect of scientific consensus on false beliefs) </strong></span>We consider Study 3 of <span class="citation" data-cites="vanStekelenburg:2021">Stekelenburg et al. (<a href="references.html#ref-vanStekelenburg:2021" role="doc-biblioref">2021</a>)</span>, who studied changes in perception of people holding false beliefs or denying (to some extent) the scientific consensus by presenting them with news article showcasing information about various phenomena. The experimental manipulation consisted in presenting boosting, a form of training to help readers identify and establish whether scientifists were truly expert in the domain of interest, how strong was the consensus, etc.<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></p>
<p>The third and final experiment of the paper focused on genetically modified organisms: it is a replication of Study 2, but with a control group (since there were no detectable difference between experimental conditions <code>Boost</code> and <code>BoostPlus</code>) and a larger sample size (because Study 2 was underpowered).</p>
<p>The data include 854 observations with <code>prior</code>, the negative of the prior belief score of the participant, the <code>post</code> experiment score for the veracity of the claim. Both were measured using a visual scale ranging from -100 (I am 100% certain this is false) to 100 (I am 100% certain this is true), with 0 (I don’t know) in the middle. Only people with negative prior beliefs were recruited to the study. The three experimental conditions were <code>BoostPlus</code>, <code>consensus</code> and a <code>control</code> group. Note that the scores in the data have been negated, meaning that negative posterior scores indicate agreement with the consensus on GMO.</p>
<p>Preliminary checks suggest that, although the slopes for prior beliefs could plausibly be the same in each group and the data are properly randomized, there is evidence of unequal variance for the changes in score. As such, we fit a model with mean <span class="math display">\[\begin{align*}
\mathsf{E}(\texttt{post}) &amp;= \begin{cases}
\beta_0 + \beta_1 \texttt{prior} + \alpha_1 &amp;  \texttt{condition} = \texttt{BoostPlus}\\
\beta_0 + \beta_1 \texttt{prior} + \alpha_2 &amp;\texttt{condition} = \texttt{consensus}\\
\beta_0 + \beta_1 \texttt{prior} + \alpha_3 &amp;\texttt{condition} = \texttt{control}
\end{cases}
\end{align*}\]</span> with <span class="math inline">\(\alpha_1 + \alpha_2 + \alpha_3=0\)</span>, using the sum-to-zero parametrization, and with different variance for each experimental condition, <span class="math display">\[\begin{align*}
\mathsf{Va}(\texttt{post}) = \begin{cases}
\sigma^2_1, &amp;  \texttt{condition} = \texttt{BoostPlus},\\
\sigma^2_2, &amp;  \texttt{condition} = \texttt{consensus},\\
\sigma^2_3, &amp; \texttt{condition} = \texttt{control}.
\end{cases}
\end{align*}\]</span> Because of the unequal variances, we cannot use multiple testing procedures reserved for analysis of variance and resort instead to Holm–Bonferroni to control the familywise error rate. We here look only at pairwise differences between conditions.<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a></p>
<div id="tbl-anovatabSSVB" class="cell tbl-parent quarto-layout-panel anchored" data-hash="06-blocking_cache/html/tbl-anovatabSSVB_35afb87f5bcf5cb0af81203ac0357415">
<div class="panel-caption table-caption">
<p>Table&nbsp;6.2: Analysis of variance tables</p>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div id="tbl-anovatabSSVB-1" class="quarto-layout-cell quarto-layout-cell-subref anchored" data-ref-parent="tbl-anovatabSSVB" style="flex-basis: 100.0%;justify-content: center;">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<caption>(a) ANOVA model (without prior belief)</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">term</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">df</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">stat</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">p-value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">condition</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">42.5</td>
<td style="text-align: left;">&lt; .001</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: center;">


</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div id="tbl-anovatabSSVB-2" class="quarto-layout-cell quarto-layout-cell-subref anchored" data-ref-parent="tbl-anovatabSSVB" style="flex-basis: 100.0%;justify-content: center;">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<caption>(b) ANCOVA model (with prior belief)</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">term</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">df</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">stat</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">p-value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">prior</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">289</td>
<td style="text-align: left;">&lt; .001</td>
</tr>
<tr class="even">
<td style="text-align: left;">condition</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">57</td>
<td style="text-align: left;">&lt; .001</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: center;">


</div>
</div>
</div>
<p>Repeating the exercise of comparing the amount of evidence for comparison with and without inclusion of a covariate shows that the value of the test statistic is larger (<a href="#tbl-anovatabSSVB">Table&nbsp;<span>6.2</span></a>), indicative of stronger evidence with the analysis of covariance model: the conclusion would be unaffected with such large sample sizes. We of course care very little for the global <span class="math inline">\(F\)</span> test of equality of mean, as the previous study had shown large differences. What is more interesting here is quantifying the change between conditions.</p>
<div id="tbl-contraststabSSVB" class="cell tbl-parent quarto-layout-panel anchored" data-hash="06-blocking_cache/html/tbl-contraststabSSVB_26d22ab28f034bc18e3e2a3319e106b9">
<div class="panel-caption table-caption">
<p>Table&nbsp;6.3: Pairwise contrasts with _p_-values adjusted using Holm--Bonferroni</p>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div id="tbl-contraststabSSVB-1" class="quarto-layout-cell quarto-layout-cell-subref anchored" data-ref-parent="tbl-contraststabSSVB" style="flex-basis: 100.0%;justify-content: center;">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<caption>(a) ANOVA model (without prior belief score).</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">contrast</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">estimate</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">std.error</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">df</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">statistic</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">consensus vs control</td>
<td style="text-align: right;">-12.0</td>
<td style="text-align: right;">4.0</td>
<td style="text-align: right;">558</td>
<td style="text-align: right;">-3.01</td>
<td style="text-align: left;">.003</td>
</tr>
<tr class="even">
<td style="text-align: left;">consensus vs BoostPlus</td>
<td style="text-align: right;">16.3</td>
<td style="text-align: right;">4.7</td>
<td style="text-align: right;">546</td>
<td style="text-align: right;">3.49</td>
<td style="text-align: left;">.001</td>
</tr>
<tr class="odd">
<td style="text-align: left;">BoostPlus vs control</td>
<td style="text-align: right;">-28.3</td>
<td style="text-align: right;">4.4</td>
<td style="text-align: right;">506</td>
<td style="text-align: right;">-6.49</td>
<td style="text-align: left;">&lt; .001</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: center;">


</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div id="tbl-contraststabSSVB-2" class="quarto-layout-cell quarto-layout-cell-subref anchored" data-ref-parent="tbl-contraststabSSVB" style="flex-basis: 100.0%;justify-content: center;">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<caption>(b) ANCOVA model (with prior belief score).</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">contrast</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">estimate</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">std.error</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">df</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">statistic</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">consensus vs control</td>
<td style="text-align: right;">-11.8</td>
<td style="text-align: right;">3.3</td>
<td style="text-align: right;">543</td>
<td style="text-align: right;">-3.54</td>
<td style="text-align: left;">&lt; .001</td>
</tr>
<tr class="even">
<td style="text-align: left;">consensus vs BoostPlus</td>
<td style="text-align: right;">17.5</td>
<td style="text-align: right;">4.3</td>
<td style="text-align: right;">524</td>
<td style="text-align: right;">4.11</td>
<td style="text-align: left;">&lt; .001</td>
</tr>
<tr class="odd">
<td style="text-align: left;">BoostPlus vs control</td>
<td style="text-align: right;">-29.3</td>
<td style="text-align: right;">3.9</td>
<td style="text-align: right;">459</td>
<td style="text-align: right;">-7.45</td>
<td style="text-align: left;">&lt; .001</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: center;">


</div>
</div>
</div>
<p><a href="#tbl-contraststabSSVB">Table&nbsp;<span>6.3</span></a> shows the pairwise contrasts, which measure two different things: the analysis of variance model compares the average in group, whereas the analysis of covariance (the linear model with <code>prior</code>) uses detrended values and focuses on the change in perception. Because the data are unbalanced and we estimate group mean and variance separately, the degrees of freedom change from one pairwise comparison to the next. Again, using the covariate <code>prior</code>, which is somewhat strongly correlated with <code>post</code> as seen in <a href="#fig-vanStekS3">Figure&nbsp;<span>6.4</span></a>, helps decrease background noise.</p>
<div class="cell" data-layout-align="center" data-hash="06-blocking_cache/html/tbl-vanStekS3_a0527f9d6f9a87839f70e1c1ec96540a">
<div class="cell-output-display">
<div id="tbl-vanStekS3" class="anchored">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Table&nbsp;6.4: Summary statistics of belief as a function of time of measurement and experimental condition.</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">time</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">condition</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">mean</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">se</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">prior</td>
<td style="text-align: left;">BoostPlus</td>
<td style="text-align: right;">57.65</td>
<td style="text-align: right;">1.69</td>
</tr>
<tr class="even">
<td style="text-align: left;">prior</td>
<td style="text-align: left;">consensus</td>
<td style="text-align: right;">56.32</td>
<td style="text-align: right;">1.67</td>
</tr>
<tr class="odd">
<td style="text-align: left;">prior</td>
<td style="text-align: left;">control</td>
<td style="text-align: right;">56.49</td>
<td style="text-align: right;">1.68</td>
</tr>
<tr class="even">
<td style="text-align: left;">post</td>
<td style="text-align: left;">BoostPlus</td>
<td style="text-align: right;">2.62</td>
<td style="text-align: right;">3.53</td>
</tr>
<tr class="odd">
<td style="text-align: left;">post</td>
<td style="text-align: left;">consensus</td>
<td style="text-align: right;">18.93</td>
<td style="text-align: right;">3.06</td>
</tr>
<tr class="even">
<td style="text-align: left;">post</td>
<td style="text-align: left;">control</td>
<td style="text-align: right;">30.91</td>
<td style="text-align: right;">2.56</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<div class="cell" data-layout-align="center" data-hash="06-blocking_cache/html/fig-vanStekS3_e6c1cc362bfd8fc867358e60d0729eea">
<div class="cell-output-display">
<div id="fig-vanStekS3" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="06-blocking_files/figure-html/fig-vanStekS3-1.png" class="img-fluid figure-img" style="width:85.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;6.4: Difference between prior and post experiment beliefs on genetically engineered food.</figcaption>
</figure>
</div>
</div>
</div>
</div>
<div class="pitfall">
<p><span class="citation" data-cites="vanStekelenburg:2021">Stekelenburg et al. (<a href="references.html#ref-vanStekelenburg:2021" role="doc-biblioref">2021</a>)</span> split their data to do pairwise comparisons two at the time (thus taking roughly two-third of the data to perform a two sample <em>t</em>-test with each pair). Although it does not impact their conclusion, this approach is conceptually incorrect: if the variance was equal, we would want to use all observations to estimate it (so their approach would be suboptimal, since we would estimate the variance three times with smaller samples).</p>
<p>On the contrary, using a model that assumes equal variance when it is not the case leads to distortion: the variance we estimate will be some sort of average of the variability <span class="math inline">\(\sigma_i\)</span> and <span class="math inline">\(\sigma_j\)</span> in experimental condition <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span>, again potentially leading to distortions. With large samples, this may be unconsequential, but illustrates caveats of subsample analyses.</p>
</div>
<div class="pitfall">
<p><a href="#fig-vanStekS3f1">Figure&nbsp;<span>6.5</span></a> shows the relationship between prior and posterior score. The data show clear difference between individuals: many start from completely disbelieving of genetically engineered food and change their mind (sometimes drastically), there are many people who do not change idea at all and have similar scores, and many who give a posterior score of zero. This heterogeneity in the data illustrates the danger of only looking at the summary statistics and comparing averages. It does not tell the whole picture! One could investigate whether the strength of religious or political beliefs, or how much participants trust scientists, could explain some of the observed differences.</p>
<div class="cell" data-layout-align="center" data-hash="06-blocking_cache/html/fig-vanStekS3f1_77cee435cc56bd4336303880c60eab95">
<div class="cell-output-display">
<div id="fig-vanStekS3f1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="06-blocking_files/figure-html/fig-vanStekS3f1-1.png" class="img-fluid figure-img" style="width:85.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;6.5: Scatterplot of negated prior and posterior belief score.</figcaption>
</figure>
</div>
</div>
</div>
</div>
<!-- Dean, Voss, Daguliic (2017), Section 10.2 -->
<!--
## Block designs with more one or more blocking factors

How to allocation observations optimally?
Do we need observations in each cells? Examples of designs

## Effect size for block designs

Removing the variability of the block.
Also for power calculations (partial)


-->
<div class="keyidea">
<p><strong>Summary</strong>:</p>
<ul>
<li>Inclusion of blocking factor and continuous covariates may help filtering out unwanted variability.</li>
<li>These are typically concomitant variables (measured alongside the response variable).</li>
<li>These designs reduce the residual error, leading to an increase in power (more ability to detect differences in average between experimental conditions).</li>
<li>We are only interested in differences due to experimental condition (marginal effects).</li>
<li>In general, there should be no interaction between covariates/blocking factors and experimental conditions.</li>
<li>This hypothesis can be assessed by comparing the models with and without interaction, if there are enough units (e.g., equality of slope for ANCOVA).</li>
</ul>
</div>
<div class="yourturn">
<ul>
<li><span class="citation" data-cites="Box:1978">Box, Hunter, and Hunter (<a href="references.html#ref-Box:1978" role="doc-biblioref">1978</a>)</span> write on page 103 the following motto:</li>
</ul>
<blockquote class="blockquote">
<p>Block what you can and randomize what you cannot.</p>
</blockquote>
<p>Explain the main benefit of blocking for confounding variables (when possible) over randomization.</p>
</div>


<div id="refs" class="references csl-bib-body hanging-indent" role="list" style="display: none">
<div id="ref-Baumann:1992" class="csl-entry" role="listitem">
Baumann, James F., Nancy Seifert-Kessell, and Leah A. Jones. 1992. <span>“Effect of Think-Aloud Instruction on Elementary Students’ Comprehension Monitoring Abilities.”</span> <em>Journal of Reading Behavior</em> 24 (2): 143–72. <a href="https://doi.org/10.1080/10862969209547770">https://doi.org/10.1080/10862969209547770</a>.
</div>
<div id="ref-Box:1978" class="csl-entry" role="listitem">
Box, G. E. P., W. G. A. Hunter, and J. S. Hunter. 1978. <em>Statistics for Experimenters: An Introduction to Design, Data Analysis, and Model Building</em>. Wiley.
</div>
<div id="ref-Lee.Choi:2019" class="csl-entry" role="listitem">
Lee, Kiljae, and Jungsil Choi. 2019. <span>“Image-Text Inconsistency Effect on Product Evaluation in Online Retailing.”</span> <em>Journal of Retailing and Consumer Services</em> 49: 279–88. <a href="https://doi.org/10.1016/j.jretconser.2019.03.015">https://doi.org/10.1016/j.jretconser.2019.03.015</a>.
</div>
<div id="ref-vanStekelenburg:2021" class="csl-entry" role="listitem">
Stekelenburg, Aart van, Gabi Schaap, Harm Veling, and Moniek Buijzen. 2021. <span>“Boosting Understanding and Identification of Scientific Consensus Can Help to Correct False Beliefs.”</span> <em>Psychological Science</em> 32 (10): 1549–65. <a href="https://doi.org/10.1177/09567976211007788">https://doi.org/10.1177/09567976211007788</a>.
</div>
</div>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>We can always check for this assumption.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>If not, this implies that the covariate interacts with the experimental condition.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>The article is interesting because lack of planning/changes led them to adapt the design from experiment 1 to 3 until they found something. Without preregistration, it is unlikely such findings would have been publishable.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>In Study 2, the interest was comparing manipulation vs control and the Boost vs BoostPlus conditions, two orthogonal contrasts.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./05-interactions_multiway.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Complete factorial designs</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./07-power_effect.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Effect sizes and power</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>